var TKIT=TKIT||{};TKIT.ContextMenu={},TKIT.ContextMenu.create=function(e,t,n,T){TKIT.ContextMenu.active&&TKIT.ContextMenu.destroy(),TKIT.ContextMenu.active=!0,TKIT.ContextMenu.centerX=n||0,TKIT.ContextMenu.centerY=T||0,TKIT.ContextMenu.items=e,TKIT.ContextMenu.actions=t,TKIT.ContextMenu.objects=[],document.addEventListener("mousemove",TKIT.ContextMenu.Events.mousemove,!1),document.addEventListener("click",TKIT.ContextMenu.Events.click,!1),TKIT.ContextMenu.createMenu()},TKIT.ContextMenu.createMenu=function(){for(var e=0;e<TKIT.ContextMenu.items.length;e++)!function(e){var t=TKIT.ContextMenu.items[e];setTimeout(function(){TKIT.ContextMenu.createItem(t,e)},100*e)}(e)},TKIT.ContextMenu.createItem=function(e,t){var n=(TKIT.ContextMenu.event,e.labelText),T=e.action,o=64,r=document.createElement("canvas");r.id="TKITContextMenuCanvas",document.body.appendChild(r);var i=document.getElementById("TKITContextMenuCanvas");i.width=1024,i.height=256;var c=i.getContext("2d");c.fillStyle="white",c.fillRect(0,0,i.width,i.height),c.font="112px Arial",c.fillStyle="black",c.fillText(n,32,164);var a=i.toDataURL("image/png"),I=new Image;I.src=a,document.body.appendChild(I);var s=new THREE.Vector3;s.set(TKIT.ContextMenu.centerX/window.innerWidth*2-1,2*-(TKIT.ContextMenu.centerY/window.innerHeight)+1,.5),s.unproject(TKIT.camera);var K=s.sub(TKIT.camera.position).normalize(),u=-TKIT.camera.position.z/K.z,d=TKIT.camera.position.clone().add(K.multiplyScalar(u)),m=new THREE.Texture(I);m.needsUpdate=!0;var l=new THREE.BoxGeometry(256,o,100),x=new THREE.MeshPhongMaterial({map:m,color:13492478,specular:1118481,shininess:30,shading:THREE.SmoothShading}),C=new THREE.Mesh(l,x);C.position.set(d.x,d.y-t*o,-1e3),C.contextmenuaction=T;var v=TKIT.ContextMenu.objects.push(C);TKIT.scene.add(TKIT.ContextMenu.objects[v-1]),setInterval(function(){C.position.z<0&&(C.position.z=C.position.z+100)},16)},TKIT.ContextMenu.destroy=function(){if(TKIT.ContextMenu.active){TKIT.ContextMenu.active=!1,document.removeEventListener("mousemove",TKIT.ContextMenu.Events.mousemove),document.removeEventListener("click",TKIT.ContextMenu.Events.click);for(var e=0;e<TKIT.ContextMenu.objects.length;e++)TKIT.scene.remove(TKIT.ContextMenu.objects[e]);TKIT.ContextMenu.objects=[]}},TKIT.ContextMenu.Events={},TKIT.ContextMenu.Events.mousemove=function(e){for(var t=TKIT.IntersectObject.intersects(e,TKIT.scene,TKIT.camera),n=0;n<TKIT.ContextMenu.objects.length;n++)TKIT.ContextMenu.objects[n].material.color.setHex(13492478);t.length>0&&t[0].object.material.color.setHex(16777215)},TKIT.ContextMenu.Events.click=function(e){var t=TKIT.IntersectObject.intersects(e,TKIT.scene,TKIT.camera);t.length>0&&TKIT.ContextMenu.actions[t[0].object.contextmenuaction](),TKIT.ContextMenu.destroy()};var TKIT=TKIT||{};TKIT.init=function(e,t){TKIT.scene=e,TKIT.camera=t},TKIT.generateBasicScene=function(){TKIT.scene=new THREE.Scene,TKIT.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),TKIT.camera.position.z=600,TKIT.light=new THREE.PointLight(16777215,1,0),TKIT.light.position.set(0,0,1e3),TKIT.scene.add(TKIT.light),TKIT.renderer=new THREE.WebGLRenderer({antialias:!0}),TKIT.renderer.setClearColor(15790320),TKIT.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(TKIT.renderer.domElement),TKIT.render=function(){requestAnimationFrame(TKIT.render),TKIT.renderer.render(TKIT.scene,TKIT.camera)},TKIT.render(),window.addEventListener("resize",function(){TKIT.camera.aspect=window.innerWidth/window.innerHeight,TKIT.camera.updateProjectionMatrix(),TKIT.renderer.setSize(window.innerWidth,window.innerHeight)})};var TKIT=TKIT||{};TKIT.InputElements={},TKIT.InputElements.create=function(e,t){e.type||"text",e.fontFamily||"Arial",e.fontColor||"black",e.fontSize||"18px",e.width||256,e.height||128,e.backgroundColor||"white",e.cursorColor||"black",e.containerBackgroundColor||"green"},TKIT=TKIT||{},TKIT.IntersectObject={},TKIT.IntersectObject.raycaster=new THREE.Raycaster,TKIT.IntersectObject.mouse=new THREE.Vector2,TKIT.IntersectObject.intersects=function(e,t,n){TKIT.IntersectObject.mouse.x=e.clientX/window.innerWidth*2-1,TKIT.IntersectObject.mouse.y=2*-(e.clientY/window.innerHeight)+1,TKIT.IntersectObject.raycaster.setFromCamera(TKIT.IntersectObject.mouse,n);var T=TKIT.IntersectObject.raycaster.intersectObjects(t.children);return T};