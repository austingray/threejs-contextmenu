var TKIT=TKIT||{};TKIT.ContextMenu={},TKIT.ContextMenu.contextmenu=function(e,t,n){TKIT.ContextMenu.active&&TKIT.ContextMenu.destroy(),TKIT.ContextMenu.active=!0,TKIT.ContextMenu.event=e,TKIT.ContextMenu.items=t,TKIT.ContextMenu.actions=n,TKIT.ContextMenu.objects=[],document.addEventListener("mousemove",TKIT.ContextMenu.Events.mousemove,!1),document.addEventListener("click",TKIT.ContextMenu.Events.click,!1),TKIT.ContextMenu.create()},TKIT.ContextMenu.create=function(){for(var e=0;e<TKIT.ContextMenu.items.length;e++)!function(e){var t=TKIT.ContextMenu.items[e];setTimeout(function(){TKIT.ContextMenu.createItem(t,e)},100*e)}(e)},TKIT.ContextMenu.createItem=function(e,t){var n=TKIT.ContextMenu.event,T=e.labelText,o=e.action,i=64,r=document.createElement("canvas");r.id="TKITContextMenuCanvas",document.body.appendChild(r);var c=document.getElementById("TKITContextMenuCanvas");c.width=1024,c.height=256;var a=c.getContext("2d");a.fillStyle="white",a.fillRect(0,0,c.width,c.height),a.font="112px Arial",a.fillStyle="black",a.fillText(T,32,164);var s=c.toDataURL("image/png"),I=new Image;I.src=s,document.body.appendChild(I);var K=new THREE.Vector3;K.set(n.clientX/window.innerWidth*2-1,2*-(n.clientY/window.innerHeight)+1,.5),K.unproject(TKIT.camera);var u=K.sub(TKIT.camera.position).normalize(),d=-TKIT.camera.position.z/u.z,m=TKIT.camera.position.clone().add(u.multiplyScalar(d)),l=new THREE.Texture(I);l.needsUpdate=!0;var x=new THREE.BoxGeometry(256,i,100),v=new THREE.MeshPhongMaterial({map:l,color:13492478,specular:1118481,shininess:30,shading:THREE.SmoothShading}),C=new THREE.Mesh(x,v);C.position.set(m.x,m.y-t*i,-1e3),C.contextmenuaction=o;var w=TKIT.ContextMenu.objects.push(C);TKIT.scene.add(TKIT.ContextMenu.objects[w-1]),setInterval(function(){C.position.z<0&&(C.position.z=C.position.z+100)},16)},TKIT.ContextMenu.destroy=function(){if(TKIT.ContextMenu.active){TKIT.ContextMenu.active=!1,document.removeEventListener("mousemove",TKIT.ContextMenu.Events.mousemove),document.removeEventListener("click",TKIT.ContextMenu.Events.click);for(var e=0;e<TKIT.ContextMenu.objects.length;e++)TKIT.scene.remove(TKIT.ContextMenu.objects[e]);TKIT.ContextMenu.objects=[]}},TKIT.ContextMenu.Events={},TKIT.ContextMenu.Events.mousemove=function(e){for(var t=TKIT.IntersectObject.intersects(e,TKIT.scene,TKIT.camera),n=0;n<TKIT.ContextMenu.objects.length;n++)TKIT.ContextMenu.objects[n].material.color.setHex(13492478);t.length>0&&t[0].object.material.color.setHex(16777215)},TKIT.ContextMenu.Events.click=function(e){var t=TKIT.IntersectObject.intersects(e,TKIT.scene,TKIT.camera);t.length>0&&TKIT.ContextMenu.actions[t[0].object.contextmenuaction](),TKIT.ContextMenu.destroy()};var TKIT=TKIT||{};TKIT.init=function(e,t){TKIT.scene=e,TKIT.camera=t},TKIT.generateBasicScene=function(){TKIT.scene=new THREE.Scene,TKIT.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),TKIT.camera.position.z=600,TKIT.light=new THREE.PointLight(16777215,1,0),TKIT.light.position.set(0,0,1e3),TKIT.scene.add(TKIT.light),TKIT.renderer=new THREE.WebGLRenderer({antialias:!0}),TKIT.renderer.setClearColor(15790320),TKIT.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(TKIT.renderer.domElement),TKIT.render=function(){requestAnimationFrame(TKIT.render),TKIT.renderer.render(TKIT.scene,TKIT.camera)},TKIT.render(),window.addEventListener("resize",function(){TKIT.camera.aspect=window.innerWidth/window.innerHeight,TKIT.camera.updateProjectionMatrix(),TKIT.renderer.setSize(window.innerWidth,window.innerHeight)})},TKIT=TKIT||{},TKIT.IntersectObject={},TKIT.IntersectObject.raycaster=new THREE.Raycaster,TKIT.IntersectObject.mouse=new THREE.Vector2,TKIT.IntersectObject.intersects=function(e,t,n){TKIT.IntersectObject.mouse.x=e.clientX/window.innerWidth*2-1,TKIT.IntersectObject.mouse.y=2*-(e.clientY/window.innerHeight)+1,TKIT.IntersectObject.raycaster.setFromCamera(TKIT.IntersectObject.mouse,n);var T=TKIT.IntersectObject.raycaster.intersectObjects(t.children);return T};